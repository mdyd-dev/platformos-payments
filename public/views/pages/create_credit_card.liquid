---
slug: create-credit-card
layout_name: ''
authorization_policies:
---

{% parse_json "properties" %}
  {
    "customer_id": "100",
    "external_customer_id": "101",
    "customer_email": "example@platform-os.com",
    "metadata": "{{ context.params.metadata | json }}"
  }
{% endparse_json %}
{% assign expires_in = 'now' | date: '%s' | plus: 100000 %}


{%- assign external_id = context.params.external_customer_id %}
{%- 
  query_graph 'modules/payments/get_customer_by_external_id',
    result_name: 'g_customer',
    external_id: external_id
-%}
{%- assign customer = g_customer.customizations.results.first -%}



{% if customer %}
  {% parse_json "data" %}
    { "customer_id": "{{ customer.id }}"}
  {% endparase_json %}
  {%-
    include_form 'modules/payments/gateway_request_form',
    gateway: 'stripe'
    request_type: 'create_card'
    data: data
  %}
{% else %}
  {%-
    include_form 'modules/payments/gateway_request_form',
    gateway: 'stripe'
    request_type: 'create_customer'
  %}
{% endif %}
